<div class="container mb-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">Novo Empréstimo</h4>
          <small class="text-white-50">Registre o empréstimo de um recurso</small>
        </div>
        <div class="card-body">
          <form [formGroup]="form" (submit)="onSubmit()" novalidate>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Pessoa *</label>
                <select class="form-select" formControlName="pessoaId"
                  [class.is-invalid]="form.controls['pessoaId'].touched && form.controls['pessoaId'].invalid">
                  <option [ngValue]="null">Selecione uma pessoa...</option>
                  @for (pessoa of pessoas(); track pessoa.id) {
                    <option [ngValue]="pessoa.id">{{ pessoa.nome }}</option>
                  }
                </select>
                @if (form.controls['pessoaId'].touched && form.controls['pessoaId'].invalid) {
                  <div class="invalid-feedback">Pessoa é obrigatória</div>
                }
              </div>

              <div class="col-md-6">
                <label class="form-label">Data de Entrega *</label>
                <input type="date" class="form-control" formControlName="dataEntrega"
                  [class.is-invalid]="form.controls['dataEntrega'].touched && form.controls['dataEntrega'].invalid">
                @if (form.controls['dataEntrega'].touched && form.controls['dataEntrega'].invalid) {
                  <div class="invalid-feedback">Data de entrega é obrigatória</div>
                }
              </div>

              <div class="col-md-6">
                <label class="form-label">Tipo de Recurso</label>
                <select class="form-select" formControlName="tipoRecursoCodigo"
                  (change)="onTipoChange(form.controls['tipoRecursoCodigo'].value)">
                  <option value="">Filtrar por tipo...</option>
                  @for (tipo of tiposRecurso(); track tipo.id) {
                    <option [value]="tipo.codigo">{{ tipo.nome }}</option>
                  }
                </select>
              </div>

              <div class="col-md-6">
                <label class="form-label">Item *</label>
                <select class="form-select" formControlName="itemId"
                  [class.is-invalid]="form.controls['itemId'].touched && form.controls['itemId'].invalid">
                  <option [ngValue]="null">Selecione um item...</option>
                  @for (item of itensDisponiveis(); track item.id) {
                    <option [ngValue]="item.id">{{ item.identificador }} - {{ item.tipoRecursoNome }}</option>
                  }
                </select>
                @if (form.controls['itemId'].touched && form.controls['itemId'].invalid) {
                  <div class="invalid-feedback">Item é obrigatório</div>
                }
                @if (form.controls['tipoRecursoCodigo'].value && itensDisponiveis().length === 0) {
                  <small class="text-muted">Nenhum item disponível para este tipo</small>
                }
              </div>
            </div>

            <div class="col-12 mt-4 d-flex justify-content-between">
              <a [routerLink]="['/emprestimos']" class="btn btn-outline-secondary">Voltar</a>
              <button type="submit" class="btn btn-primary" [disabled]="form.invalid || loading()">
                Registrar Empréstimo
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
