<div class="card" [class.border-success]="isRecursoAtivo()" [class.border-danger]="!isRecursoAtivo()"
    style="width: 100%;">

    <div class="card-header-styled" [class.bg-success-subtle]="isRecursoAtivo()"
        [class.bg-danger-subtle]="!isRecursoAtivo()" (click)="toggleCollapse()" [attr.aria-expanded]="!isCollapsed()"
        [attr.aria-controls]="'recursoDetalhes-' + recurso().id" tabindex="0" role="button">

        <span class="status-badge" [class.active]="isRecursoAtivo()" [class.inactive]="!isRecursoAtivo()">
            {{ isRecursoAtivo() ? 'Ativo' : 'Devolvido' }}
        </span>

        <div class="d-flex justify-content-between align-items-center card-header-clickable">
            <div class="flex-grow-1">
                <div class="tipo-badge">
                    {{ recurso().item.tipoRecursoNome }}
                </div>

                <h5 class="card-title mb-0">
                    {{ recurso().item.identificador || 'Identificador não disponível' }}
                </h5>

                <h6 class="card-subtitle mb-0">
                    <span class="text-muted" style="font-size: 0.8rem;">
                        {{ recurso().dataEntrega | dateDisplayPipe }} → {{ recurso().dataDevolucao | dateDisplayPipe }}
                    </span>
                </h6>
            </div>

            <i class="bi ms-3" [class]="isCollapsed() ? 'bi-chevron-down' : 'bi-chevron-up'"></i>
        </div>
    </div>

    <div class="card-content-area">

        <div class="collapse" [class.show]="!isCollapsed()" id="recursoDetalhes-{{ recurso().id }}">

            <div class="row nowrap-details">

                <div class="col-md-6 mb-2">
                    <strong>Item ID</strong>
                    <a [routerLink]="['/itens', recurso().item.id, 'detalhes']">
                        {{ recurso().item.id || 'N/D' }}
                    </a>
                </div>

                @for (attr of atributosFormatados(); track attr.key) {
                    <div class="col-md-6 mb-2">
                        <strong>{{ attr.key }}</strong>
                        {{ attr.value }}
                    </div>
                }

                <div class="col-md-6 mb-2">
                    <strong>Data de Entrega</strong>
                    {{ recurso().dataEntrega | dateDisplayPipe }}
                </div>
                <div class="col-md-6 mb-2">
                    <strong>Data de Devolucao</strong>
                    {{ recurso().dataDevolucao | dateDisplayPipe }}
                </div>

                @if (recurso().itensExtras && recurso().itensExtras!.length > 0) {
                    <div class="col-12 mb-2">
                        <strong>Itens Extras</strong>
                        <ul class="list-unstyled mb-0 ms-2">
                            @for (extra of recurso().itensExtras; track $index) {
                                <li>
                                    {{ extra.quantidade || 1 }}x {{ extra.descricao }}
                                    @if (extra.marca) { - {{ extra.marca }} }
                                    @if (extra.numeroSerie) { ({{ extra.numeroSerie }}) }
                                    @if (extra.ddd) { DDD: {{ extra.ddd }} }
                                    @if (extra.valor) { R$ {{ extra.valor }} }
                                </li>
                            }
                        </ul>
                    </div>
                }

            </div>
            <div class="d-flex gap-2 mt-3">
                <button (click)="onEditarRecurso()" class="btn btn-primary">
                    Registrar Devolucao
                </button>
                <button appConfirmDelete (confirmedDelete)="onConfirmDelete($event)" class="btn btn-danger">
                    Deletar
                </button>
            </div>
        </div>
    </div>
</div>
